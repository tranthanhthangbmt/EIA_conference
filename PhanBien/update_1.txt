Tuyá»‡t vá»i. ChÃºng ta sáº½ biáº¿n energy.html tá»« má»™t â€œthanh pinâ€ Ä‘Æ¡n giáº£n thÃ nh má»™t PhÃ²ng Lab Äo lÆ°á»ng Chuyá»ƒn hÃ³a NÄƒng lÆ°á»£ng (Metabolic Efficiency Lab).
Má»¥c tiÃªu cá»§a pháº§n nÃ y lÃ  cung cáº¥p báº±ng chá»©ng Ä‘á»‹nh lÆ°á»£ng cho RQ1: Chi phÃ­ sinh há»c (Biological Cost). ChÃºng ta sáº½ chá»©ng minh ráº±ng: Äá»ƒ Ä‘áº¡t cÃ¹ng 1 Ä‘iá»ƒm kiáº¿n thá»©c, EFA pháº£i Ä‘á»‘t nhiá»u nÄƒng lÆ°á»£ng gáº¥p 3-4 láº§n Bio-PKT do â€œma sÃ¡tâ€ cá»§a Stress.
DÆ°á»›i Ä‘Ã¢y lÃ  chi tiáº¿t triá»ƒn khai cho Trá»¥ cá»™t Sinh há»c.

1. CÆ¡ sá»Ÿ Khoa há»c (The Scientific Rationale)
Äá»ƒ thuyáº¿t phá»¥c Reviewer, chÃºng ta cáº§n Ä‘Æ°a vÃ o 2 chá»‰ sá»‘ má»›i:
1. Hiá»‡u suáº¥t Chuyá»ƒn hÃ³a Tá»©c thá»i ( J_metabolic ):
J(t)=Î”EnergyUsed/Î”MasteryGained
o EFA: Khi Stress cao, máº«u sá»‘ ( Î”Mastery ) giáº£m vá» 0, khiáº¿n J(t) tiáº¿n tá»›i vÃ´ cÃ¹ng (LÃ£ng phÃ­ cá»±c Ä‘áº¡i).
o Bio-PKT: Giá»¯ chá»‰ sá»‘ nÃ y tháº¥p vÃ  á»•n Ä‘á»‹nh (Hiá»‡u quáº£ cao).
2. Ná»£ NÄƒng lÆ°á»£ng (Energy Debt / Allostatic Load):
o Khi nÄƒng lÆ°á»£ng xuá»‘ng dÆ°á»›i ngÆ°á»¡ng tá»›i háº¡n (vÃ­ dá»¥ 20%), há»‡ thá»‘ng báº¯t Ä‘áº§u â€œvay nÃ³ngâ€ tá»« ngÃ¢n hÃ ng sá»©c khá»e. Khoáº£n ná»£ nÃ y pháº£i tráº£ báº±ng thá»i gian há»“i phá»¥c gáº¥p Ä‘Ã´i.

2. Cáº­p nháº­t Giao diá»‡n: energy.html
ChÃºng ta cáº§n chia mÃ n hÃ¬nh thÃ nh cÃ¡c khu vá»±c hiá»ƒn thá»‹ dá»¯ liá»‡u chuyÃªn sÃ¢u hÆ¡n.
HÃ£y thay tháº¿ ná»™i dung trong tháº» <body> (pháº§n container chÃ­nh) báº±ng mÃ£ sau:
<div class="container-energy">
    <h1>ğŸ”¬ Biological Constraints Analysis (Trá»¥ cá»™t Sinh há»c)</h1>
    
    <div class="vitals-panel">
        <div class="agent-box efa-box">
            <h2>EFA (Greedy)</h2>
            <div class="meter-label">Energy Reserves</div>
            <div class="progress-bg"><div id="efa-energy-bar" class="progress-fill red"></div></div>
            <div class="metric-row">
                <span>Metabolic Rate:</span> 
                <span id="efa-metabolic" class="critical-value">---</span> J/pt
            </div>
            <div class="metric-row">
                <span>Energy Debt:</span> 
                <span id="efa-debt" class="danger-text">0</span> units
            </div>
        </div>

        <div class="agent-box bio-box">
            <h2>Bio-PKT (Ours)</h2>
            <div class="meter-label">Energy Reserves</div>
            <div class="progress-bg"><div id="bio-energy-bar" class="progress-fill green"></div></div>
            <div class="metric-row">
                <span>Metabolic Rate:</span> 
                <span id="bio-metabolic" class="optimal-value">---</span> J/pt
            </div>
            <div class="metric-row">
                <span>Energy Debt:</span> 
                <span id="bio-debt" class="safe-text">0</span> units
            </div>
        </div>
    </div>

    <div class="chart-section">
        <h3>ğŸ“‰ Cost of Learning (Chi phÃ­ NÄƒng lÆ°á»£ng trÃªn má»—i Ä‘iá»ƒm Kiáº¿n thá»©c)</h3>
        <p class="scientific-note">
            *Biá»ƒu Ä‘á»“ nÃ y chá»©ng minh "Ma sÃ¡t Stress": ÄÆ°á»ng cÃ ng cao = CÃ ng lÃ£ng phÃ­ nÄƒng lÆ°á»£ng.
            EFA (Äá») sáº½ tÄƒng vá»t theo hÃ m mÅ© khi Stress cao. Bio-PKT (Xanh) duy trÃ¬ á»•n Ä‘á»‹nh.
        </p>
        <div class="canvas-container">
            <canvas id="metabolicChart"></canvas>
        </div>
    </div>
</div>

3. Cáº­p nháº­t Logic: script_energy.js
ÄÃ¢y lÃ  nÆ¡i â€œma thuáº­tâ€ xáº£y ra. ChÃºng ta sáº½ tÃ­nh toÃ¡n cÃ¡i giÃ¡ pháº£i tráº£ cho má»—i hÃ nh Ä‘á»™ng.
HÃ£y cáº­p nháº­t (hoáº·c thay tháº¿) ná»™i dung file JS nhÆ° sau:
// Cáº¥u hÃ¬nh Chart.js
let metabolicChartCtx = document.getElementById('metabolicChart').getContext('2d');
let metabolicChart = new Chart(metabolicChartCtx, {
    type: 'line',
    data: {
        labels: [],
        datasets: [{
            label: 'EFA Cost (Joules/Point)',
            borderColor: '#ff4444', // Äá»
            data: [],
            fill: false,
            tension: 0.4
        }, {
            label: 'Bio-PKT Cost (Joules/Point)',
            borderColor: '#44cc44', // Xanh
            data: [],
            fill: false,
            tension: 0.4
        }]
    },
    options: {
        animation: false,
        scales: {
            y: {
                beginAtZero: true,
                title: { display: true, text: 'Energy Cost per Mastery Point' },
                max: 20 // Giá»›i háº¡n trá»¥c Y Ä‘á»ƒ tháº¥y rÃµ sá»± bÃ¹ng ná»• cá»§a EFA
            }
        }
    }
});

// Biáº¿n theo dÃµi Ná»£ nÄƒng lÆ°á»£ng
let efaDebt = 0;
let bioDebt = 0;

// HÃ m tÃ­nh toÃ¡n chi phÃ­ chuyá»ƒn hÃ³a (Metabolic Cost Calculation)
function calculateMetabolicCost(energySpent, masteryGained) {
    // Náº¿u khÃ´ng há»c Ä‘Æ°á»£c gÃ¬ (Gain=0) mÃ  váº«n tá»‘n nÄƒng lÆ°á»£ng -> Chi phÃ­ lÃ  VÃ´ cÃ¹ng
    if (masteryGained <= 0.1) return 20; // Cap á»Ÿ má»©c 20 Ä‘á»ƒ váº½ biá»ƒu Ä‘á»“ cho Ä‘áº¹p
    let cost = energySpent / masteryGained;
    return Math.min(cost, 20); // Clamp value
}

// --- Cáº¬P NHáº¬T TRONG VÃ’NG Láº¶P SIMULATION ---
// (Gá»i hÃ m nÃ y bÃªn trong hÃ m step() chÃ­nh cá»§a báº¡n)

function updateEnergyMetrics(efaAction, efaGain, bioAction, bioGain) {
    
    // 1. TÃ­nh chi phÃ­ thá»±c táº¿ (Actual Energy Cost)
    // EFA bá»‹ pháº¡t thÃªm nÄƒng lÆ°á»£ng khi Stress cao (Stress Tax)
    let efaStressTax = (greedy.stress > 70) ? 1.5 : 1.0; 
    let efaRealCost = efaAction.cost * efaStressTax;
    
    let bioStressTax = (bio.stress > 70) ? 1.5 : 1.0;
    let bioRealCost = bioAction.cost * bioStressTax;

    // 2. TÃ­nh chá»‰ sá»‘ Metabolic Rate (J/pt)
    let efaMetric = calculateMetabolicCost(efaRealCost, efaGain);
    let bioMetric = calculateMetabolicCost(bioRealCost, bioGain);

    // 3. TÃ­nh Ná»£ NÄƒng lÆ°á»£ng (Energy Debt)
    // Náº¿u Energy < 20%, báº¯t Ä‘áº§u tÃ­ch lÅ©y ná»£
    if (greedy.energy < 20) efaDebt += 1.5; // LÃ£i suáº¥t cao
    if (bio.energy < 20) bioDebt += 0.5;    // Bio Ã­t khi bá»‹, nhÆ°ng náº¿u bá»‹ thÃ¬ nháº¹ hÆ¡n

    // --- Cáº¬P NHáº¬T UI ---
    
    // Text Metrics
    document.getElementById('efa-metabolic').innerText = efaMetric.toFixed(2);
    document.getElementById('bio-metabolic').innerText = bioMetric.toFixed(2);
    document.getElementById('efa-debt').innerText = Math.round(efaDebt);
    document.getElementById('bio-debt').innerText = Math.round(bioDebt);

    // Bars
    document.getElementById('efa-energy-bar').style.width = greedy.energy + "%";
    document.getElementById('bio-energy-bar').style.width = bio.energy + "%";

    // Chart Update (Má»—i 5 frame update 1 láº§n cho Ä‘á»¡ lag)
    if (globalTime % 5 === 0) {
        metabolicChart.data.labels.push(globalTime);
        metabolicChart.data.datasets[0].data.push(efaMetric);
        metabolicChart.data.datasets[1].data.push(bioMetric);
        
        // Giá»¯ biá»ƒu Ä‘á»“ trÃ´i (xoÃ¡ dá»¯ liá»‡u cÅ©)
        if (metabolicChart.data.labels.length > 50) {
            metabolicChart.data.labels.shift();
            metabolicChart.data.datasets[0].data.shift();
            metabolicChart.data.datasets[1].data.shift();
        }
        metabolicChart.update();
    }
}

4. ThÃªm Style vÃ o style_emotion.css (hoáº·c style.css)
/* Layout cho Energy Dashboard */
.container-energy {
    background: #1a1a1a;
    color: #eee;
    padding: 20px;
    font-family: 'Segoe UI', sans-serif;
}

.vitals-panel {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}

.agent-box {
    flex: 1;
    background: #2d2d2d;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #444;
}

.efa-box { border-top: 4px solid #ff4444; }
.bio-box { border-top: 4px solid #44cc44; }

.metric-row {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
    font-size: 1.1em;
}

.critical-value { color: #ff4444; font-weight: bold; }
.optimal-value { color: #44cc44; font-weight: bold; }

.progress-bg {
    background: #444;
    height: 20px;
    border-radius: 10px;
    overflow: hidden;
}

.progress-fill { height: 100%; transition: width 0.2s; }
.progress-fill.red { background: linear-gradient(90deg, #ff4444, #cc0000); }
.progress-fill.green { background: linear-gradient(90deg, #44cc44, #008800); }

.scientific-note {
    font-style: italic;
    color: #aaa;
    font-size: 0.9em;
    margin-bottom: 10px;
}

5. PhÃ¢n tÃ­ch káº¿t quáº£ (DÃ nh cho BÃ i bÃ¡o)
Sau khi code xong vÃ  cháº¡y energy.html, báº¡n sáº½ tháº¥y hiá»‡n tÆ°á»£ng sau Ä‘á»ƒ viáº¿t vÃ o bÃ i bÃ¡o:
1. Giai Ä‘oáº¡n Ä‘áº§u (TÃ i nguyÃªn dá»“i dÃ o): Hai Ä‘Æ°á»ng trÃªn biá»ƒu Ä‘á»“ trÃ¹ng nhau (~2.0 J/pt). EFA vÃ  Bio-PKT hiá»‡u quáº£ nhÆ° nhau.
2. Giai Ä‘oáº¡n Stress (Äiá»ƒm gÃ£y):
o ÄÆ°á»ng mÃ u Ä‘á» (EFA) báº¯t Ä‘áº§u dao Ä‘á»™ng máº¡nh vÃ  tÄƒng vá»t lÃªn má»©c 10-20 J/pt.
o Giáº£i thÃ­ch: EFA Ä‘ang cá»‘ â€œlÃ¡i xe lÃªn dá»‘c báº±ng sá»‘ 5â€. NÃ³ Ä‘á»‘t ráº¥t nhiá»u nÄƒng lÆ°á»£ng nhÆ°ng xe (kiáº¿n thá»©c) háº§u nhÆ° khÃ´ng nhÃ­ch lÃªn.
3. Khoáº£n ná»£ (The Debt):
o Sá»‘ Energy Debt cá»§a EFA tÄƒng lÃªn hÃ ng trÄƒm Ä‘Æ¡n vá»‹. ÄÃ¢y lÃ  con sá»‘ áº©n dá»¥ cho â€œSá»± tá»•n háº¡i táº¿ bÃ o tháº§n kinhâ€ hoáº·c â€œBurnout mÃ£n tÃ­nhâ€ mÃ  má»™t giáº¥c ngá»§ Ä‘Ãªm khÃ´ng thá»ƒ bÃ¹ Ä‘áº¯p háº¿t.
Viá»‡c tÃ¡ch riÃªng file energy.html vá»›i cÃ¡c chá»‰ sá»‘ chuyÃªn sÃ¢u nÃ y giÃºp bÃ i bÃ¡o cá»§a báº¡n cÃ³ thÃªm má»™t Layer (Lá»›p) phÃ¢n tÃ­ch sinh há»c cá»±c ká»³ Ä‘áº¯t giÃ¡.
